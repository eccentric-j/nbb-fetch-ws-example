import * as esm_import$readline from "readline";
import * as esm_import$vm from "vm";
import { $APP, shadow$provide, $jscomp } from "./nbb_api.js";
import  "./nbb_core.js";
const shadow_esm_import = function(x) { return import(x) };
'use strict';var o3=function(a){var b=function(){var e=$APP.ts.h(a,"(");return $APP.n(e)?new $APP.I(null,2,5,$APP.J,[$APP.Mj.j(a,0,e+1),$APP.Mj.h(a,e+1)],null):new $APP.I(null,2,5,$APP.J,[null,a],null)}(),c=$APP.D.j(b,0,null),d=$APP.D.j(b,1,null);b=$APP.Ne.h(function(){try{return $APP.kZ(new $APP.k(null,2,[$APP.T,$APP.r.g($APP.t(n3)),$APP.ON,d],null))}catch(f){var e=f;console.warn($APP.r.g($APP.BS),$APP.dl(e));return null}}(),"completions");return $APP.Uj.h(function(e){return[$APP.r.g(c),$APP.r.g(e)].join("")},
$APP.vh(function(e){return $APP.Da(e,d)},$APP.Uj.h(function(e){return $APP.Ne.h(e,"candidate")},b)))},p3=function(a){return[$APP.tr.g(o3(a)),a]},t3=function(a,b){$APP.dh(q3,!1);a.setPrompt([$APP.r.g($APP.t(n3)),"\x3d\x3e "].join(""));a.prompt();return $APP.cm($APP.t(r3))?null:s3.h?s3.h(b,a):s3.call(null,b,a)},u3=function(a){var b=$APP.pm(a);a=$APP.qm(a);var c=$APP.bm($APP.t(r3));b=$APP.kh.h(b-1,c);c=$APP.x(b);b=$APP.z(c);c=$APP.B(c);a=$APP.n(b)?$APP.Mj.h(b,a):null;$APP.dh(r3,$APP.Np.h("\n",$APP.cg(a,
c)))},lpa=function(a,b){b={f:b};v3.createContext(b);try{return $APP.n($APP.n(w3)?$APP.mb(a):w3)&&process.stdin.setRawMode(!1),v3.runInContext("f()",b,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"}).then(function(c){var d={f:$APP.n(a)?function(){return c}:function(){var e=$APP.z(c);$APP.HC.l($APP.E([e]));return c}};v3.createContext(d);return v3.runInContext("f()",d,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"})}).finally(function(){return $APP.n($APP.n(w3)?$APP.mb(a):
w3)?process.stdin.setRawMode(!0):null})}catch(c){return b=c,$APP.n($APP.n(w3)?$APP.mb(a):w3)&&process.stdin.setRawMode(!0),Promise.reject(b)}},s3=function(a,b){if($APP.n(function(){var e=$APP.t(q3);return $APP.n(e)?e:$APP.cm($APP.t(r3))}()))return null;$APP.dh(q3,!0);var c=$APP.Sv($APP.t(r3)),d=function(){try{var e=$APP.Dg([$APP.cr,$APP.t(n3)]);$APP.uq(e);try{return $APP.hx(c)}finally{$APP.wq()}}catch(f){e=f;if(-1!=$APP.dl(e).indexOf("EOF while reading"))return x3;u3(c);$APP.HC.l($APP.E([$APP.r.g(e)]));
return y3}}();if($APP.C.h(y3,d))return t3(b,a);if($APP.C.h(x3,d))return $APP.dh(q3,!1);u3(c);if($APP.C.h($APP.Fw,d))return $APP.dh(q3,!1);$APP.uq($APP.Dg([$APP.cr,$APP.t(n3)]));return lpa(a,function(){return $APP.jx(null,null,new $APP.k(null,2,[$APP.nx,$APP.Au,$APP.lx,function(){var e=$APP.uk.g(!1);return function(){return $APP.mb($APP.t(e))?($APP.dh(e,!0),d):$APP.Fw}}()],null))}).then(function(e){var f=new $APP.I(null,2,5,$APP.J,[$APP.z(e),$APP.Hw($APP.Ow(),$APP.gx)],null);e=$APP.D.j(f,0,null);f=
$APP.D.j(f,1,null);$APP.dh(n3,f);$APP.oW.h($APP.bW,$APP.bh($APP.t($APP.aW)));$APP.oW.h($APP.aW,$APP.bh($APP.t($APP.$V)));$APP.oW.h($APP.$V,$APP.bh(e));$APP.n(a)&&a.write($APP.DC.l($APP.E([e])));return t3(b,a)}).catch(function(e){$APP.HC.l($APP.E([$APP.r.g(e)]));$APP.oW.h($APP.cW,$APP.bh(e));return t3(b,a)}).finally(function(){return $APP.wq()})},z3=function(a,b){a.on("line",function(c){$APP.vk.D(r3,$APP.r,c,"\n");return s3(b,a)})},B3=function(a){return A3.createInterface({input:a,output:a,completer:p3})},
mpa=function(a){var b=B3(a);z3(b,a);a.setNoDelay(!0);return a.on("close",function(){return $APP.GC.l($APP.E(["Client closed connection."]))})},y3=new $APP.H("nbb.impl.repl","continue","nbb.impl.repl/continue",-1326808644),C3=new $APP.v(null,"nbb.impl.repl","nbb.impl.repl",-339140484,null),npa=new $APP.v(null,"get-completions","get-completions",1933789168,null),opa=new $APP.v("nbb.impl.repl","completer*","nbb.impl.repl/completer*",455172317,null),ppa=new $APP.v(null,"completer*","completer*",-648150376,
null),D3=new $APP.v(null,"_opts","_opts",1634624069,null),x3=new $APP.H("nbb.impl.repl","eof-while-reading","nbb.impl.repl/eof-while-reading",1743626215),qpa=new $APP.v("nbb.impl.repl","socket-repl","nbb.impl.repl/socket-repl",1509490200,null),rpa=new $APP.v("nbb.impl.repl","repl","nbb.impl.repl/repl",-1645296655,null);var A3=esm_import$readline;var v3=esm_import$vm;var n3=$APP.uk.g($APP.t($APP.cr)),r3=$APP.uk.g(""),q3=$APP.uk.g(!1),w3,E3=process.stdout.isTTY;w3=$APP.n(E3)?process.stdin.setRawMode:E3;process.binding("contextify");var F3=$APP.Dw($APP.tO),G3=function G3(a){switch(arguments.length){case 0:return G3.v();case 1:return G3.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.r.g(arguments.length)].join(""));}};G3.v=function(){return G3.g(null)};
G3.g=function(a){var b=function(){var d=$APP.mZ.g(a);return $APP.n(d)?d:0}(),c=$APP.rZ.createServer(mpa);return c.listen(b,"127.0.0.1",function(){var d=c.address(),e=d.address;return $APP.GC.l($APP.E([["Socket REPL listening on port ",$APP.r.g(d.port)," on host ",$APP.r.g(e)].join("")]))})};G3.o=1;var H3=function H3(a){switch(arguments.length){case 0:return H3.v();case 1:return H3.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.r.g(arguments.length)].join(""));}};H3.v=function(){return H3.g(null)};
H3.g=function(){function a(d){return $APP.aZ(new $APP.G(null,$APP.tl,new $APP.G(null,new $APP.G(null,$APP.tl,new $APP.G(null,d,null,1,null),2,null),null,1,null),2,null))}$APP.n(w3)&&process.stdin.setRawMode(!0);var b=$APP.D.j($APP.rW,0,null),c=$APP.D.j($APP.rW,1,null);$APP.GC.l($APP.E([["Welcome to nbb v",$APP.Jx(),"!"].join("")]));return a(b).then(function(){return a(c)}).then(function(){return new Promise(function(d){var e=$APP.n(null)?B3(null):A3.createInterface({input:process.stdin,output:process.stdout,
completer:p3});z3(e,null);e.setPrompt([$APP.r.g($APP.t(n3)),"\x3d\x3e "].join(""));e.on("close",d);return e.prompt()})})};H3.o=1;
var spa=new $APP.k(null,3,[$APP.oZ,function(){var a=new $APP.yd(function(){return H3},rpa,$APP.Ti([$APP.T,$APP.P,$APP.Qm,$APP.WA,$APP.$G,$APP.Vn,$APP.Rm,$APP.XA,$APP.X,$APP.Z,$APP.YA],[C3,$APP.oZ,"nbb/impl/repl.cljs",11,new $APP.k(null,6,[$APP.GQ,!1,$APP.Gs,1,$APP.OF,1,$APP.fG,new $APP.I(null,2,5,$APP.J,[$APP.uh,new $APP.I(null,1,5,$APP.J,[D3],null)],null),$APP.X,$APP.K($APP.uh,new $APP.I(null,1,5,$APP.J,[D3],null)),$APP.wJ,$APP.K(null,null)],null),1,198,198,$APP.K($APP.uh,new $APP.I(null,1,5,$APP.J,
[D3],null)),null,$APP.n(H3)?H3.I:null])),b=$APP.t(a);a=$APP.se(a);var c=$APP.n(null)?null:$APP.P.g(a),d=new $APP.k(null,4,[$APP.T,F3,$APP.P,c,$APP.X,$APP.X.g(a),$APP.Z,$APP.Z.g(a)],null);return $APP.n($APP.mr.g(a))?$APP.xw(c,b,d):$APP.n($APP.Pq.g(a))?$APP.yw(c,b,d):$APP.ww(c,b,d)}(),npa,function(){var a=new $APP.yd(function(){return o3},opa,$APP.Ti([$APP.T,$APP.P,$APP.Qm,$APP.WA,$APP.Vn,$APP.Rm,$APP.XA,$APP.X,$APP.Z,$APP.YA],[C3,ppa,"nbb/impl/repl.cljs",17,1,16,16,$APP.K(new $APP.I(null,1,5,$APP.J,
[$APP.Fia],null)),"Given a line, returns a flat vector of completions",$APP.n(o3)?o3.I:null])),b=$APP.t(a);a=$APP.se(a);var c=$APP.n(null)?null:$APP.P.g(a),d=new $APP.k(null,4,[$APP.T,F3,$APP.P,c,$APP.X,$APP.X.g(a),$APP.Z,$APP.Z.g(a)],null);return $APP.n($APP.mr.g(a))?$APP.xw(c,b,d):$APP.n($APP.Pq.g(a))?$APP.yw(c,b,d):$APP.ww(c,b,d)}(),$APP.qZ,function(){var a=new $APP.yd(function(){return G3},qpa,$APP.Ti([$APP.T,$APP.P,$APP.Qm,$APP.WA,$APP.$G,$APP.Vn,$APP.Rm,$APP.XA,$APP.X,$APP.Z,$APP.YA],[C3,$APP.qZ,
"nbb/impl/repl.cljs",18,new $APP.k(null,6,[$APP.GQ,!1,$APP.Gs,1,$APP.OF,1,$APP.fG,new $APP.I(null,2,5,$APP.J,[$APP.uh,new $APP.I(null,1,5,$APP.J,[$APP.kL],null)],null),$APP.X,$APP.K($APP.uh,new $APP.I(null,1,5,$APP.J,[$APP.kL],null)),$APP.wJ,$APP.K(null,null)],null),1,183,183,$APP.K($APP.uh,new $APP.I(null,1,5,$APP.J,[$APP.kL],null)),null,$APP.n(G3)?G3.I:null])),b=$APP.t(a);a=$APP.se(a);var c=$APP.n(null)?null:$APP.P.g(a),d=new $APP.k(null,4,[$APP.T,F3,$APP.P,c,$APP.X,$APP.X.g(a),$APP.Z,$APP.Z.g(a)],
null);return $APP.n($APP.mr.g(a))?$APP.xw(c,b,d):$APP.n($APP.Pq.g(a))?$APP.yw(c,b,d):$APP.ww(c,b,d)}()],null);try{$APP.sx(new $APP.k(null,1,[$APP.$q,new $APP.k(null,1,[$APP.tO,spa],null)],null))}catch(a){throw console.error("An error occurred when calling (nbb.impl.repl/init)"),a;};
export { $APP, shadow$provide, $jscomp };
